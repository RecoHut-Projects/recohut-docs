# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/models/models.jaccard_similarity.ipynb (unless otherwise specified).

__all__ = ['JaccardSimilarity']

# Cell
import pandas as pd
import operator

# Cell
class JaccardSimilarity:
    """Using the Jaccard Index, we can retrieve top-k similar items to a given item.
    This provides a way to recommend items of a user which are similar to the
    items that the user has history with.
    """
    def fit(self, df, user_col='user_id', item_col='item_id'):
        self.item_col = item_col
        self.item_sets = dict((item, set(users)) for item, users in df.groupby(item_col)[user_col])

    def _jaccard(self, item1, item2):
        a = self.item_sets[item1]
        b = self.item_sets[item2]
        intersection = float(len(a.intersection(b)))
        return intersection / (len(a) + len(b) - intersection)

    def recommend(self, itemid, top_k=5):
        jaccard_dict = {x: self._jaccard(x, itemid) for x in self.item_sets}
        ranked_items = sorted(jaccard_dict.items(), key=operator.itemgetter(1), reverse=True)[1:top_k+1]
        return ranked_items